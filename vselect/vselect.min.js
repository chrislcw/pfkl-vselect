import e from"jquery";e.fn.vSelect=function(t){let l={multiSelect:!0,placeholder:"Please select",checkAll:!0,checkAllLabel:"All",expanded:!0,display:"sum",trayHeight:"240px",dropdown:!0,onChange:function(e,t){}},i;null!==t&&e.each(t,function(e,t){l[e]=t});let c=e(this);c.hide();let o="-"+Math.floor(1e3*Math.random())+"-"+Math.floor(1e3*Math.random()),a=[];function d(e){a.map((t,l)=>{"option"===t.type?t.checked=e:t.options.map((t,l)=>{t.checked=e})})}c.children().each(function(t){let l=e(this);if("OPTION"===l[0].nodeName)a.push({type:"option",value:l.val(),label:l.text(),checked:!1});else if("OPTGROUP"===l[0].nodeName){let i=[];l.children().each(function(t){let l=e(this);i.push({type:"option",value:l.val(),label:l.text(),checked:!1})}),a.push({type:"optgroup",value:0,label:l.attr("label"),options:i,checked:!1})}});let n=e("<div></div>").insertAfter(c);n.addClass("vselect-container "+(l.multiSelect?"multi-select":"single-select")),n.attr("id","vselect"+o);let s=e('<div class="vselect-display-container vselect-tray-toggle" data-target="#vselect-tray'+o+'"><div class="vselect-selected-display"><span class="vselect-display-text">'+l.placeholder+'</span></div><div class="vselect-collapse-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div></div>');n.append(s);let p=e('<div class="vselect-tray-container"></div>');n.append(p);let h=e('<div class="vselect-tray '+(l.dropdown?"dropdown":"")+'" id="vselect-tray'+o+'" style="height: '+l.trayHeight+'"></div>');function v(t,i,c=null,a=!1){let d=e('<div><input type="checkbox" id="vselect-option-'+(a?a+"-"+(null===c?i:i+"-"+c):i+o)+'" value="'+t.value+'" data-index="'+(null===c?i:i+"-"+c)+'"><label for="vselect-option-'+(a?a+"-"+(null===c?i:i+"-"+c):i+o)+'">'+t.label+"</label></div>");h.append(d),d.addClass("vselect-option"),d.addClass((a?"vselect-option-child ":"")+(a||"")),a?l.expanded||d.hide():d.addClass("vselect-option-solo"),null===c?d.find("input[type=checkbox]").attr("data-type","solo"):(d.find("input[type=checkbox]").attr("data-type","child"),d.find("input[type=checkbox]").attr("data-group-id",a),d.find("input[type=checkbox]").addClass("vselect-child-"+a)),l.multiSelect||d.find("input[type=checkbox]").hide()}p.append(h),h.hide(),n.find(".vselect-tray-toggle").on("click",function(){let t=e(this),l=t.data("target");t.hasClass("active")?(t.removeClass("active"),e(l).hide()):(t.addClass("active"),e(l).show())}),l.multiSelect&&l.checkAll&&(i=e('<div class="vselect-global"><input type="checkbox" id="vselect-global'+o+'" data-type="all"><label for="vselect-global'+o+'" class="" for="vselect-global">'+l.checkAllLabel+"</label></div>"),h.append(i),i.find("input[type=checkbox]").on("change",function(){let t=e(this),l=t.is(":checked");n.find(".vselect-option input[type=checkbox]").prop("checked",l),c.find("option").prop("selected",l),d(l),f()})),e.each(a,function(t){let i=e(this)[0];if("option"===i.type&&v(i,t),"optgroup"===i.type){var c,a,d;let n=i.label.toLowerCase().replace(/ /g,"_").replace(/[^\w\s]/gi,"")+o,s;c=i,a=t,d=n,l.multiSelect?(s=e('<div><input type="checkbox" id="vselect-group-'+d+'" data-group-id="'+d+'" data-index="'+a+'"><label for="vselect-group-'+d+'">'+c.label+'</label><div data-group-id="'+d+'" class="vselect-collapse-toggle vselect-group-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div>'),h.append(s),s.find("input[type=checkbox]").attr("data-type","group")):(s=e('<div><label class="vselect-group-label">'+c.label+'</label><div data-group-id="'+d+'" class="vselect-collapse-toggle vselect-group-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div>'),h.append(s)),s.addClass("vselect-option"),s.addClass("vselect-option-group"),l.expanded&&s.find(".vselect-group-toggle").addClass("active"),e.each(i.options,function(l){let i=e(this)[0];v(i,t,l,n)})}});let r=n.find(".vselect-option"),u=n.find(".vselect-option-group");function g(e,t){var i;let o=e.data("type"),d,n;(n="child"===o?a[parseInt((d=e.data("index").split("-"))[0])].options[parseInt(d[1])]:a[d=e.data("index")]).checked=t,i=n,!l.multiSelect&&i.checked&&c.find("option").prop("selected",!1),c.find('option[value="'+i.value+'"]').prop("selected",i.checked),l.onChange(n,a)}function f(){let e=[];if(a.map((t,l)=>{"option"===t.type?"option"===t.type&&t.checked&&e.push(t):t.options.map((t,l)=>{"option"===t.type&&t.checked&&e.push(t)})}),e.length>0){if("sum"===l.display)n.find(".vselect-display-text").text(e.length+" option(s) selected");else{let t=[];e.map((e,l)=>{t.push(e.label)}),n.find(".vselect-display-text").text(t.join("; "))}}else n.find(".vselect-display-text").text(l.placeholder)}return u.find(".vselect-group-toggle").on("click",function(){let t=e(this),l=t.data("group-id");t.hasClass("active")?(t.removeClass("active"),n.find(".vselect-option-child."+l).hide()):(t.addClass("active"),n.find(".vselect-option-child."+l).show())}),r.find("input[type=checkbox]").on("change",function(t){let i=e(this),a=i.is(":checked");if(l.multiSelect||(h.hide(),n.find(".vselect-tray-toggle").removeClass("active")),!l.multiSelect&&!a){t.preventDefault(),i.prop("checked",!0);return}let s=i.data("type");switch(l.multiSelect||(d(!1),r.find("input[type=checkbox]").not(i).each(function(){e(this).prop("checked",!1)}),r.find("input[type=checkbox]").parent().removeClass("active"),i.parent().addClass("active")),s){case"solo":break;case"group":(function t(l,i){let o=l.data("group-id");n.find(".vselect-child-"+o).prop("checked",i),n.find(".vselect-child-"+o).each(function(){let t=e(this),l=t.val();c.find("option[value="+l+"]").prop("selected",i),g(t,i)}),f()})(i,a);break;case"child":l.multiSelect&&function t(l){let i=l.data("group-id"),c=n.find(".vselect-option-child."+i+" input[type=checkbox]"),o=!0;c.each(function(){let t=e(this),l=t.is(":checked");l||(o=l)}),o?n.find("#vselect-group-"+i).prop("checked",!0):n.find("#vselect-group-"+i).prop("checked",!1)}(i)}l.multiSelect&&l.checkAll&&function t(){let l=n.find(".vselect-option input[type=checkbox]"),i=!0;l.each(function(){let t=e(this),l=t.is(":checked");l||(i=l)}),i?e("#vselect-global"+o).prop("checked",!0):e("#vselect-global"+o).prop("checked",!1)}(),g(i,a),f()}),n};