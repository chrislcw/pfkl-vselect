import e from"jquery";e.fn.vSelect=function(t){e(this).each(function(){!function t(l,i){let c={multiSelect:!0,placeholder:"Please select",checkAll:!0,checkAllLabel:"All",expanded:!0,display:"sum",trayHeight:"240px",dropdown:!0,onChange:function(e,t){}},a;null!==i&&e.each(i,function(e,t){c[e]=t});let o=l;o.hide();let s="-"+Math.floor(1e3*Math.random())+"-"+Math.floor(1e3*Math.random()),d=[],n=[];function p(e){d.map((t,l)=>{"option"===t.type?t.checked=e:t.options.map((t,l)=>{t.checked=e})})}o.children().each(function(t){let l=e(this),i=!!l.attr("selected");if(i&&("OPTION"===l[0].nodeName?n.push(l.attr("value")):n.push(l.attr("label"))),"OPTION"===l[0].nodeName)d.push({type:"option",value:l.val(),label:l.text(),checked:!1,class:l.attr("class"),disabled:l.attr("disabled")});else if("OPTGROUP"===l[0].nodeName){let c=[];l.children().each(function(t){let i=e(this),a=!!i.attr("selected");a&&n.push(i.attr("value")),c.push({type:"option",value:i.val(),label:i.text(),checked:!1,class:l.attr("class"),disabled:l.attr("disabled")})}),d.push({type:"optgroup",value:0,label:l.attr("label"),options:c,checked:!1})}});let h=e("<div></div>").insertAfter(o);h.addClass("vselect-container "+(c.multiSelect?"multi-select":"single-select")),h.attr("id","vselect"+s);let r=e('<div class="vselect-display-container vselect-tray-toggle" data-target="#vselect-tray'+s+'"><div class="vselect-selected-display"><span class="vselect-display-text">'+c.placeholder+'</span></div><div class="vselect-collapse-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div></div>');h.append(r);let v=e('<div class="vselect-tray-container"></div>');h.append(v);let u=e('<div class="vselect-tray '+(c.dropdown?"dropdown":"")+'" id="vselect-tray'+s+'" style="height: '+c.trayHeight+'"></div>');function g(t,l,i=null,a=!1){let o=e('<div><input type="checkbox" id="vselect-option-'+(a?a+"-"+(null===i?l:l+"-"+i):l+s)+'" value="'+t.value+'" data-index="'+(null===i?l:l+"-"+i)+'"><label for="vselect-option-'+(a?a+"-"+(null===i?l:l+"-"+i):l+s)+'">'+t.label+"</label></div>");u.append(o),void 0!==t.class&&o.addClass(t.class),"disabled"===t.disabled&&(o.find("input[type=checkbox]").attr("disabled","true"),o.css("pointer-events","none")),o.addClass("vselect-option"),o.addClass((a?"vselect-option-child ":"")+(a||"")),a?c.expanded||o.hide():o.addClass("vselect-option-solo"),null===i?o.find("input[type=checkbox]").attr("data-type","solo"):(o.find("input[type=checkbox]").attr("data-type","child"),o.find("input[type=checkbox]").attr("data-group-id",a),o.find("input[type=checkbox]").addClass("vselect-child-"+a)),c.multiSelect||o.find("input[type=checkbox]").hide()}v.append(u),u.hide(),h.find(".vselect-tray-toggle").on("click",function(){let t=e(this),l=t.data("target");t.hasClass("active")?(t.removeClass("active"),e(l).hide()):(t.addClass("active"),e(l).show())}),c.multiSelect&&c.checkAll&&(a=e('<div class="vselect-global"><input type="checkbox" id="vselect-global'+s+'" data-type="all"><label for="vselect-global'+s+'" class="" for="vselect-global">'+c.checkAllLabel+"</label></div>"),u.append(a),a.find("input[type=checkbox]").on("change",function(){let t=e(this),l=t.is(":checked");h.find(".vselect-option input[type=checkbox]").prop("checked",l),o.find("option").prop("selected",l),p(l),b()})),e.each(d,function(t){let l=e(this)[0];if("option"===l.type&&g(l,t),"optgroup"===l.type){var i,a,o;let d=l.label.toLowerCase().replace(/ /g,"_").replace(/[^\w\s]/gi,"")+s,n;i=l,a=t,o=d,c.multiSelect?(n=e('<div><input type="checkbox" value="'+i.label+'" id="vselect-group-'+o+'" data-group-id="'+o+'" data-index="'+a+'"><label for="vselect-group-'+o+'">'+i.label+'</label><div data-group-id="'+o+'" class="vselect-collapse-toggle vselect-group-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div>'),u.append(n),n.find("input[type=checkbox]").attr("data-type","group")):(n=e('<div><label class="vselect-group-label">'+i.label+'</label><div data-group-id="'+o+'" class="vselect-collapse-toggle vselect-group-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div>'),u.append(n)),n.addClass("vselect-option"),n.addClass("vselect-option-group"),c.expanded&&n.find(".vselect-group-toggle").addClass("active"),e.each(l.options,function(l){let i=e(this)[0];g(i,t,l,d)})}});let f=h.find(".vselect-option"),k=h.find(".vselect-option-group");function $(e,t){var l;let i=e.data("type"),a,s;(s="child"===i?d[parseInt((a=e.data("index").split("-"))[0])].options[parseInt(a[1])]:d[a=e.data("index")]).checked=t,l=s,!c.multiSelect&&l.checked&&o.find("option").prop("selected",!1),o.find('option[value="'+l.value+'"]').prop("selected",l.checked),c.onChange(s,d)}function b(){let e=[];if(d.map((t,l)=>{"option"===t.type?"option"===t.type&&t.checked&&e.push(t):t.options.map((t,l)=>{"option"===t.type&&t.checked&&e.push(t)})}),e.length>0){if("sum"===c.display)h.find(".vselect-display-text").text(e.length+" option(s) selected");else{let t=[];e.map((e,l)=>{t.push(e.label)}),h.find(".vselect-display-text").text(t.join("; "))}}else h.find(".vselect-display-text").text(c.placeholder)}return k.find(".vselect-group-toggle").on("click",function(){let t=e(this),l=t.data("group-id");t.hasClass("active")?(t.removeClass("active"),h.find(".vselect-option-child."+l).hide()):(t.addClass("active"),h.find(".vselect-option-child."+l).show())}),f.find("input[type=checkbox]").on("change",function(t){let l=e(this),i=l.is(":checked");if(c.multiSelect||(u.hide(),h.find(".vselect-tray-toggle").removeClass("active")),!c.multiSelect&&!i){t.preventDefault(),l.prop("checked",!0);return}let a=l.data("type");switch(c.multiSelect||(p(!1),f.find("input[type=checkbox]").not(l).each(function(){e(this).prop("checked",!1)}),f.find("input[type=checkbox]").parent().removeClass("active"),l.parent().addClass("active")),a){case"solo":break;case"group":(function t(l,i){let c=l.data("group-id");h.find(".vselect-child-"+c).prop("checked",i),h.find(".vselect-child-"+c).each(function(){let t=e(this),l=t.val();o.find("option[value="+l+"]").prop("selected",i),$(t,i)}),b()})(l,i);break;case"child":c.multiSelect&&function t(l){let i=l.data("group-id"),c=h.find(".vselect-option-child."+i+" input[type=checkbox]"),a=!0;c.each(function(){let t=e(this),l=t.is(":checked");l||(a=l)}),a?h.find("#vselect-group-"+i).prop("checked",!0):h.find("#vselect-group-"+i).prop("checked",!1)}(l)}c.multiSelect&&c.checkAll&&function t(){let l=h.find(".vselect-option input[type=checkbox]"),i=!0;l.each(function(){let t=e(this),l=t.is(":checked");l||(i=l)}),i?e("#vselect-global"+s).prop("checked",!0):e("#vselect-global"+s).prop("checked",!1)}(),$(l,i),b()}),n.length>0&&n.map((e,t)=>{let l=h.find('.vselect-option input[type="checkbox"][value="'+e+'"]');l.prop("checked",!0),l.trigger("change")}),h}(e(this),t)})};