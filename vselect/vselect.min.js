import e from"jquery";e.fn.vSelect=function(t){let l={multiSelect:!0,placeholder:"Please select",checkAll:!0,checkAllLabel:"All",expanded:!0,display:"sum",trayHeight:"240px",dropdown:!0,onChange:function(e,t){}},i;null!==t&&e.each(t,function(e,t){l[e]=t});let c=e(this);c.hide();let o="-"+Math.floor(1e3*Math.random())+"-"+Math.floor(1e3*Math.random()),a=[];function s(e){a.map((t,l)=>{"option"===t.type?t.checked=e:t.options.map((t,l)=>{t.checked=e})})}c.children().each(function(t){let l=e(this);if("OPTION"===l[0].nodeName)a.push({type:"option",value:l.val(),label:l.text(),checked:!1,class:l.attr("class"),disabled:l.attr("disabled")});else if("OPTGROUP"===l[0].nodeName){let i=[];l.children().each(function(t){let c=e(this);i.push({type:"option",value:c.val(),label:c.text(),checked:!1,class:l.attr("class"),disabled:l.attr("disabled")})}),a.push({type:"optgroup",value:0,label:l.attr("label"),options:i,checked:!1})}}),console.log("options",a);let d=e("<div></div>").insertAfter(c);d.addClass("vselect-container "+(l.multiSelect?"multi-select":"single-select")),d.attr("id","vselect"+o);let n=e('<div class="vselect-display-container vselect-tray-toggle" data-target="#vselect-tray'+o+'"><div class="vselect-selected-display"><span class="vselect-display-text">'+l.placeholder+'</span></div><div class="vselect-collapse-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div></div>');d.append(n);let p=e('<div class="vselect-tray-container"></div>');d.append(p);let h=e('<div class="vselect-tray '+(l.dropdown?"dropdown":"")+'" id="vselect-tray'+o+'" style="height: '+l.trayHeight+'"></div>');function r(t,i,c=null,a=!1){let s=e('<div><input type="checkbox" id="vselect-option-'+(a?a+"-"+(null===c?i:i+"-"+c):i+o)+'" value="'+t.value+'" data-index="'+(null===c?i:i+"-"+c)+'"><label for="vselect-option-'+(a?a+"-"+(null===c?i:i+"-"+c):i+o)+'">'+t.label+"</label></div>");h.append(s),void 0!==t.class&&s.addClass(t.class),"disabled"===t.disabled&&(s.find("input[type=checkbox]").attr("disabled","true"),s.css("pointer-events","none")),s.addClass("vselect-option"),s.addClass((a?"vselect-option-child ":"")+(a||"")),a?l.expanded||s.hide():s.addClass("vselect-option-solo"),null===c?s.find("input[type=checkbox]").attr("data-type","solo"):(s.find("input[type=checkbox]").attr("data-type","child"),s.find("input[type=checkbox]").attr("data-group-id",a),s.find("input[type=checkbox]").addClass("vselect-child-"+a)),l.multiSelect||s.find("input[type=checkbox]").hide()}p.append(h),h.hide(),d.find(".vselect-tray-toggle").on("click",function(){let t=e(this),l=t.data("target");t.hasClass("active")?(t.removeClass("active"),e(l).hide()):(t.addClass("active"),e(l).show())}),l.multiSelect&&l.checkAll&&(i=e('<div class="vselect-global"><input type="checkbox" id="vselect-global'+o+'" data-type="all"><label for="vselect-global'+o+'" class="" for="vselect-global">'+l.checkAllLabel+"</label></div>"),h.append(i),i.find("input[type=checkbox]").on("change",function(){let t=e(this),l=t.is(":checked");d.find(".vselect-option input[type=checkbox]").prop("checked",l),c.find("option").prop("selected",l),s(l),f()})),e.each(a,function(t){let i=e(this)[0];if("option"===i.type&&r(i,t),"optgroup"===i.type){var c,a,s;let d=i.label.toLowerCase().replace(/ /g,"_").replace(/[^\w\s]/gi,"")+o,n;c=i,a=t,s=d,l.multiSelect?(n=e('<div><input type="checkbox" id="vselect-group-'+s+'" data-group-id="'+s+'" data-index="'+a+'"><label for="vselect-group-'+s+'">'+c.label+'</label><div data-group-id="'+s+'" class="vselect-collapse-toggle vselect-group-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div>'),h.append(n),n.find("input[type=checkbox]").attr("data-type","group")):(n=e('<div><label class="vselect-group-label">'+c.label+'</label><div data-group-id="'+s+'" class="vselect-collapse-toggle vselect-group-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div>'),h.append(n)),n.addClass("vselect-option"),n.addClass("vselect-option-group"),l.expanded&&n.find(".vselect-group-toggle").addClass("active"),e.each(i.options,function(l){let i=e(this)[0];r(i,t,l,d)})}});let v=d.find(".vselect-option"),u=d.find(".vselect-option-group");function g(e,t){var i;let o=e.data("type"),s,d;(d="child"===o?a[parseInt((s=e.data("index").split("-"))[0])].options[parseInt(s[1])]:a[s=e.data("index")]).checked=t,i=d,!l.multiSelect&&i.checked&&c.find("option").prop("selected",!1),c.find('option[value="'+i.value+'"]').prop("selected",i.checked),l.onChange(d,a)}function f(){let e=[];if(a.map((t,l)=>{"option"===t.type?"option"===t.type&&t.checked&&e.push(t):t.options.map((t,l)=>{"option"===t.type&&t.checked&&e.push(t)})}),e.length>0){if("sum"===l.display)d.find(".vselect-display-text").text(e.length+" option(s) selected");else{let t=[];e.map((e,l)=>{t.push(e.label)}),d.find(".vselect-display-text").text(t.join("; "))}}else d.find(".vselect-display-text").text(l.placeholder)}return u.find(".vselect-group-toggle").on("click",function(){let t=e(this),l=t.data("group-id");t.hasClass("active")?(t.removeClass("active"),d.find(".vselect-option-child."+l).hide()):(t.addClass("active"),d.find(".vselect-option-child."+l).show())}),v.find("input[type=checkbox]").on("change",function(t){let i=e(this),a=i.is(":checked");if(l.multiSelect||(h.hide(),d.find(".vselect-tray-toggle").removeClass("active")),!l.multiSelect&&!a){t.preventDefault(),i.prop("checked",!0);return}let n=i.data("type");switch(l.multiSelect||(s(!1),v.find("input[type=checkbox]").not(i).each(function(){e(this).prop("checked",!1)}),v.find("input[type=checkbox]").parent().removeClass("active"),i.parent().addClass("active")),n){case"solo":break;case"group":(function t(l,i){let o=l.data("group-id");d.find(".vselect-child-"+o).prop("checked",i),d.find(".vselect-child-"+o).each(function(){let t=e(this),l=t.val();c.find("option[value="+l+"]").prop("selected",i),g(t,i)}),f()})(i,a);break;case"child":l.multiSelect&&function t(l){let i=l.data("group-id"),c=d.find(".vselect-option-child."+i+" input[type=checkbox]"),o=!0;c.each(function(){let t=e(this),l=t.is(":checked");l||(o=l)}),o?d.find("#vselect-group-"+i).prop("checked",!0):d.find("#vselect-group-"+i).prop("checked",!1)}(i)}l.multiSelect&&l.checkAll&&function t(){let l=d.find(".vselect-option input[type=checkbox]"),i=!0;l.each(function(){let t=e(this),l=t.is(":checked");l||(i=l)}),i?e("#vselect-global"+o).prop("checked",!0):e("#vselect-global"+o).prop("checked",!1)}(),g(i,a),f()}),d};