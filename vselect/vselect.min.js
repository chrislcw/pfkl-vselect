import e from"jquery";e.fn.vSelect=function(t){let l={multiSelect:!0,placeholder:"Please select",checkAll:!0,checkAllLabel:"All",expanded:!0,display:"sum",trayHeight:"240px",dropdown:!0,onChange:function(e,t){}},i;null!==t&&e.each(t,function(e,t){l[e]=t});let c=e(this);c.hide();let a="-"+Math.floor(1e3*Math.random())+"-"+Math.floor(1e3*Math.random()),o=[],s=[];function d(e){o.map((t,l)=>{"option"===t.type?t.checked=e:t.options.map((t,l)=>{t.checked=e})})}c.children().each(function(t){let l=e(this),i=!!l.attr("selected");if(i&&("OPTION"===l[0].nodeName?s.push(l.attr("value")):s.push(l.attr("label"))),"OPTION"===l[0].nodeName)o.push({type:"option",value:l.val(),label:l.text(),checked:!1,class:l.attr("class"),disabled:l.attr("disabled")});else if("OPTGROUP"===l[0].nodeName){let c=[];l.children().each(function(t){let i=e(this),a=!!i.attr("selected");a&&s.push(i.attr("value")),c.push({type:"option",value:i.val(),label:i.text(),checked:!1,class:l.attr("class"),disabled:l.attr("disabled")})}),o.push({type:"optgroup",value:0,label:l.attr("label"),options:c,checked:!1})}});let n=e("<div></div>").insertAfter(c);n.addClass("vselect-container "+(l.multiSelect?"multi-select":"single-select")),n.attr("id","vselect"+a);let p=e('<div class="vselect-display-container vselect-tray-toggle" data-target="#vselect-tray'+a+'"><div class="vselect-selected-display"><span class="vselect-display-text">'+l.placeholder+'</span></div><div class="vselect-collapse-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div></div>');n.append(p);let h=e('<div class="vselect-tray-container"></div>');n.append(h);let r=e('<div class="vselect-tray '+(l.dropdown?"dropdown":"")+'" id="vselect-tray'+a+'" style="height: '+l.trayHeight+'"></div>');function v(t,i,c=null,o=!1){let s=e('<div><input type="checkbox" id="vselect-option-'+(o?o+"-"+(null===c?i:i+"-"+c):i+a)+'" value="'+t.value+'" data-index="'+(null===c?i:i+"-"+c)+'"><label for="vselect-option-'+(o?o+"-"+(null===c?i:i+"-"+c):i+a)+'">'+t.label+"</label></div>");r.append(s),void 0!==t.class&&s.addClass(t.class),"disabled"===t.disabled&&(s.find("input[type=checkbox]").attr("disabled","true"),s.css("pointer-events","none")),s.addClass("vselect-option"),s.addClass((o?"vselect-option-child ":"")+(o||"")),o?l.expanded||s.hide():s.addClass("vselect-option-solo"),null===c?s.find("input[type=checkbox]").attr("data-type","solo"):(s.find("input[type=checkbox]").attr("data-type","child"),s.find("input[type=checkbox]").attr("data-group-id",o),s.find("input[type=checkbox]").addClass("vselect-child-"+o)),l.multiSelect||s.find("input[type=checkbox]").hide()}h.append(r),r.hide(),n.find(".vselect-tray-toggle").on("click",function(){let t=e(this),l=t.data("target");t.hasClass("active")?(t.removeClass("active"),e(l).hide()):(t.addClass("active"),e(l).show())}),l.multiSelect&&l.checkAll&&(i=e('<div class="vselect-global"><input type="checkbox" id="vselect-global'+a+'" data-type="all"><label for="vselect-global'+a+'" class="" for="vselect-global">'+l.checkAllLabel+"</label></div>"),r.append(i),i.find("input[type=checkbox]").on("change",function(){let t=e(this),l=t.is(":checked");n.find(".vselect-option input[type=checkbox]").prop("checked",l),c.find("option").prop("selected",l),d(l),k()})),e.each(o,function(t){let i=e(this)[0];if("option"===i.type&&v(i,t),"optgroup"===i.type){var c,o,s;let d=i.label.toLowerCase().replace(/ /g,"_").replace(/[^\w\s]/gi,"")+a,n;c=i,o=t,s=d,l.multiSelect?(n=e('<div><input type="checkbox" value="'+c.label+'" id="vselect-group-'+s+'" data-group-id="'+s+'" data-index="'+o+'"><label for="vselect-group-'+s+'">'+c.label+'</label><div data-group-id="'+s+'" class="vselect-collapse-toggle vselect-group-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div>'),r.append(n),n.find("input[type=checkbox]").attr("data-type","group")):(n=e('<div><label class="vselect-group-label">'+c.label+'</label><div data-group-id="'+s+'" class="vselect-collapse-toggle vselect-group-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div>'),r.append(n)),n.addClass("vselect-option"),n.addClass("vselect-option-group"),l.expanded&&n.find(".vselect-group-toggle").addClass("active"),e.each(i.options,function(l){let i=e(this)[0];v(i,t,l,d)})}});let u=n.find(".vselect-option"),g=n.find(".vselect-option-group");function f(e,t){var i;let a=e.data("type"),s,d;(d="child"===a?o[parseInt((s=e.data("index").split("-"))[0])].options[parseInt(s[1])]:o[s=e.data("index")]).checked=t,i=d,!l.multiSelect&&i.checked&&c.find("option").prop("selected",!1),c.find('option[value="'+i.value+'"]').prop("selected",i.checked),l.onChange(d,o)}function k(){let e=[];if(o.map((t,l)=>{"option"===t.type?"option"===t.type&&t.checked&&e.push(t):t.options.map((t,l)=>{"option"===t.type&&t.checked&&e.push(t)})}),e.length>0){if("sum"===l.display)n.find(".vselect-display-text").text(e.length+" option(s) selected");else{let t=[];e.map((e,l)=>{t.push(e.label)}),n.find(".vselect-display-text").text(t.join("; "))}}else n.find(".vselect-display-text").text(l.placeholder)}return g.find(".vselect-group-toggle").on("click",function(){let t=e(this),l=t.data("group-id");t.hasClass("active")?(t.removeClass("active"),n.find(".vselect-option-child."+l).hide()):(t.addClass("active"),n.find(".vselect-option-child."+l).show())}),u.find("input[type=checkbox]").on("change",function(t){let i=e(this),o=i.is(":checked");if(l.multiSelect||(r.hide(),n.find(".vselect-tray-toggle").removeClass("active")),!l.multiSelect&&!o){t.preventDefault(),i.prop("checked",!0);return}let s=i.data("type");switch(l.multiSelect||(d(!1),u.find("input[type=checkbox]").not(i).each(function(){e(this).prop("checked",!1)}),u.find("input[type=checkbox]").parent().removeClass("active"),i.parent().addClass("active")),s){case"solo":break;case"group":(function t(l,i){let a=l.data("group-id");n.find(".vselect-child-"+a).prop("checked",i),n.find(".vselect-child-"+a).each(function(){let t=e(this),l=t.val();c.find("option[value="+l+"]").prop("selected",i),f(t,i)}),k()})(i,o);break;case"child":l.multiSelect&&function t(l){let i=l.data("group-id"),c=n.find(".vselect-option-child."+i+" input[type=checkbox]"),a=!0;c.each(function(){let t=e(this),l=t.is(":checked");l||(a=l)}),a?n.find("#vselect-group-"+i).prop("checked",!0):n.find("#vselect-group-"+i).prop("checked",!1)}(i)}l.multiSelect&&l.checkAll&&function t(){let l=n.find(".vselect-option input[type=checkbox]"),i=!0;l.each(function(){let t=e(this),l=t.is(":checked");l||(i=l)}),i?e("#vselect-global"+a).prop("checked",!0):e("#vselect-global"+a).prop("checked",!1)}(),f(i,o),k()}),s.length>0&&s.map((t,l)=>{let i=e('.vselect-option input[type="checkbox"][value="'+t+'"]');i.prop("checked",!0),i.trigger("change")}),n};