import e from"jquery";e.fn.vSelect=function(t){let l=[];return(e(this).each(function(){l.push(function t(l,i){let c={multiSelect:!0,placeholder:"Please select",checkAll:!0,checkAllLabel:"All",expanded:!0,display:"sum",trayHeight:"240px",dropdown:!0,search:!1,onChange:function(e,t){}},a;null!==i&&e.each(i,function(e,t){c[e]=t});let s=l;s.hide();let o="-"+Math.floor(1e3*Math.random())+"-"+Math.floor(1e3*Math.random()),n=[],d=[];function p(e){n.map((t,l)=>{"option"===t.type?t.checked=e:t.options.map((t,l)=>{t.checked=e})})}s.children().each(function(t){let l=e(this),i=!!l.attr("selected");if(i&&("OPTION"===l[0].nodeName?d.push(l.attr("value")):d.push(l.attr("label"))),"OPTION"===l[0].nodeName)n.push({type:"option",value:l.val(),label:l.text(),checked:!1,class:l.attr("class"),disabled:l.attr("disabled")});else if("OPTGROUP"===l[0].nodeName){let c=[];l.children().each(function(t){let i=e(this),a=!!i.attr("selected");a&&d.push(i.attr("value")),c.push({type:"option",value:i.val(),label:i.text(),checked:!1,class:l.attr("class"),disabled:l.attr("disabled")})}),n.push({type:"optgroup",value:0,label:l.attr("label"),options:c,checked:!1})}});let r=e("<div></div>").insertAfter(s);r.addClass("vselect-container "+(c.multiSelect?"multi-select":"single-select")),r.attr("id","vselect"+o);let h=e('<div class="vselect-display-container vselect-tray-toggle" data-target="#vselect-tray'+o+'"><div class="vselect-selected-display"><span class="vselect-display-text">'+c.placeholder+'</span></div><div class="vselect-collapse-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div></div>');r.append(h);let v=e('<div class="vselect-tray-container"></div>');r.append(v);let u=e('<div class="vselect-tray '+(c.dropdown?"dropdown":"")+'" id="vselect-tray'+o+'" style="height: '+c.trayHeight+'"></div>');function f(t,l,i=null,a=!1){let s=e('<div><input type="checkbox" id="vselect-option-'+(a?a+"-"+(null===i?l:l+"-"+i):l+o)+'" value="'+t.value+'" data-index="'+(null===i?l:l+"-"+i)+'"><label for="vselect-option-'+(a?a+"-"+(null===i?l:l+"-"+i):l+o)+'">'+t.label+"</label></div>");u.append(s),void 0!==t.class&&s.addClass(t.class),"disabled"===t.disabled&&(s.find("input[type=checkbox]").attr("disabled","true"),s.css("pointer-events","none"),s.addClass("vselect-option-disabled")),s.addClass("vselect-option"),s.addClass((a?"vselect-option-child ":"")+(a||"")),a?c.expanded||s.hide():s.addClass("vselect-option-solo"),null===i?s.find("input[type=checkbox]").attr("data-type","solo"):(s.find("input[type=checkbox]").attr("data-type","child"),s.find("input[type=checkbox]").attr("data-group-id",a),s.find("input[type=checkbox]").addClass("vselect-child-"+a)),c.multiSelect||s.find("input[type=checkbox]").hide()}v.append(u),m(u),r.find(".vselect-tray-toggle").on("click",function(){var t;let l=e(this),c=l.data("target");l.hasClass("active")?(l.removeClass("active"),m(e(c))):(l.addClass("active"),(t=e(c)).show(),i.search&&(r.find(".vselect-search-box").show(),r.find(".vselect-search-input").val(""),r.find(".vselect-search-input").trigger("keyup"),r.find(".vselect-search-input").trigger("focus")))}),c.multiSelect&&c.checkAll&&(a=e('<div class="vselect-global"><input type="checkbox" id="vselect-global'+o+'" data-type="all"><label for="vselect-global'+o+'" class="" for="vselect-global">'+c.checkAllLabel+"</label></div>"),u.append(a),a.find("input[type=checkbox]").on("change",function(){let t=e(this),l=t.is(":checked");r.find(".vselect-option input[type=checkbox]").prop("checked",l),s.find("option").prop("selected",l),p(l),y()})),e.each(n,function(t){let l=e(this)[0];if("option"===l.type&&f(l,t),"optgroup"===l.type){var i,a,s;let n=l.label.toLowerCase().replace(/ /g,"_").replace(/[^\w\s]/gi,"")+o,d;i=l,a=t,s=n,c.multiSelect?(d=e('<div><input type="checkbox" value="'+i.label+'" id="vselect-group-'+s+'" data-group-id="'+s+'" data-index="'+a+'"><label for="vselect-group-'+s+'">'+i.label+'</label><div data-group-id="'+s+'" class="vselect-collapse-toggle vselect-group-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div>'),u.append(d),d.find("input[type=checkbox]").attr("data-type","group")):(d=e('<div><label class="vselect-group-label">'+i.label+'</label><div data-group-id="'+s+'" class="vselect-collapse-toggle vselect-group-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1L5 5L9 1" stroke="#202020" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div>'),u.append(d)),d.addClass("vselect-option"),d.addClass("vselect-option-group"),c.expanded&&d.find(".vselect-group-toggle").addClass("active"),e.each(l.options,function(l){let i=e(this)[0];f(i,t,l,n)})}});let g=r.find(".vselect-option"),k=r.find(".vselect-option-group");function b(e,t){var l;let i=e.data("type"),a,o;(o="child"===i?n[parseInt((a=e.data("index").split("-"))[0])].options[parseInt(a[1])]:n[a=e.data("index")]).checked=t,l=o,!c.multiSelect&&l.checked&&s.find("option").prop("selected",!1),s.find('option[value="'+l.value+'"]').prop("selected",l.checked),c.onChange(o,n)}function y(){let e=[];if(n.map((t,l)=>{"option"===t.type?"option"===t.type&&t.checked&&e.push(t):t.options.map((t,l)=>{"option"===t.type&&t.checked&&e.push(t)})}),e.length>0){if("sum"===c.display)r.find(".vselect-display-text").text(e.length+" option(s) selected");else{let t=[];e.map((e,l)=>{t.push(e.label)}),r.find(".vselect-display-text").text(t.join("; "))}}else r.find(".vselect-display-text").text(c.placeholder)}if(k.find(".vselect-group-toggle").on("click",function(){let t=e(this),l=t.data("group-id");t.hasClass("active")?(t.removeClass("active"),r.find(".vselect-option-child."+l).hide()):(t.addClass("active"),r.find(".vselect-option-child."+l).show())}),g.find("input[type=checkbox]").on("change",function(t){let l=e(this),i=l.is(":checked");if(c.multiSelect||(m(u),r.find(".vselect-tray-toggle").removeClass("active")),!c.multiSelect&&!i){t.preventDefault(),l.prop("checked",!0);return}let a=l.data("type");switch(c.multiSelect||(p(!1),g.find("input[type=checkbox]").not(l).each(function(){e(this).prop("checked",!1)}),g.find("input[type=checkbox]").parent().removeClass("active"),l.parent().addClass("active")),a){case"solo":break;case"group":(function t(l,i){let c=l.data("group-id");r.find(".vselect-child-"+c).prop("checked",i),r.find(".vselect-child-"+c).each(function(){let t=e(this),l=t.val();s.find("option[value="+l+"]").prop("selected",i),b(t,i)}),y()})(l,i);break;case"child":c.multiSelect&&function t(l){let i=l.data("group-id"),c=r.find(".vselect-option-child."+i+" input[type=checkbox]"),a=!0;c.each(function(){let t=e(this),l=t.is(":checked");l||(a=l)}),a?r.find("#vselect-group-"+i).prop("checked",!0):r.find("#vselect-group-"+i).prop("checked",!1)}(l)}c.multiSelect&&c.checkAll&&function t(){let l=r.find(".vselect-option input[type=checkbox]"),i=!0;l.each(function(){let t=e(this),l=t.is(":checked");l||(i=l)}),i?e("#vselect-global"+o).prop("checked",!0):e("#vselect-global"+o).prop("checked",!1)}(),b(l,i),y()}),i.search){let $=e('<div class="vselect-search-box" style="display: none;"></div>');r.find(".vselect-display-container").append($);let x=e('<input type="text" placeholder="Search" class="vselect-search-input" />');$.append(x),x.on("keyup",function(t){var l=e(this).val().toLowerCase();r.find(".vselect-option").filter(function(){e(this).toggle(0===e(this).find("label").text().toLowerCase().indexOf(l))})}),x.on("click",function(e){e.stopPropagation()})}function m(e){e.hide(),i.search&&r.find(".vselect-search-box").hide()}return d.length>0&&d.map((e,t)=>{let l=r.find('.vselect-option input[type="checkbox"][value="'+e+'"]');l.prop("checked",!0),l.trigger("change")}),e(document).on("click",function(t){var l=e(t.target);l.is("#vselect"+o)||l.closest("#vselect"+o).length||(m(u),r.find(".vselect-tray-toggle").removeClass("active"))}),r}(e(this),t))}),1===l.length)?l[0]:l.length>1?l:null};